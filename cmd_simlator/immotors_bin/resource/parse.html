<html>
<link href="/immotors/resource/jsoneditor.min.css" rel="stylesheet" type="text/css">
<script src="/immotors/resource/jquery.min.js"></script>
<script src="/immotors/resource/jsoneditor.min.js"></script>

<body>
<table style="width: 100%;height: 100%">
    <tr>
        <td style="width:30%;border: solid 1px">
            <table style="width: 100%;height: 100%">
                <tr style="height: 50%">
                    <td>
                        <textarea id="hex_textarea" style="width: 100%;height: 100%"
                                  placeholder="在这里输入智己报文">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</textarea>
                    </td>
                </tr>
                <tr style="height: 20px">
                    <td>
                        <button id="parse_btn" onclick="parse()"
                                style="width: 100%;font-size: 18px;color: green">解析
                        </button>
                    </td>
                </tr>
                <tr style="height: 20px">
                    <td>
                        <button onclick="clearOutput()">清除日志
                        </button>
                    </td>
                </tr>
                <tr>
                    <td>
                        <textarea id="output" readonly style="width: 100%;height: 100%"></textarea>
                    </td>
                </tr>
            </table>

        </td>
        <td style="border: solid 1px">
            <div id="jsoneditor" style="width: 100%; height: 100%;overflow:scroll"></div>
        </td>
    </tr>
</table>

</body>
<script type="text/javascript">

    // create the editor
    const container = document.getElementById("jsoneditor")
    // const options = {mode: 'view'}
    const options = {mode:'code'}
    const editor = new JSONEditor(container, options)

    function parse() {
        editor.set({})
        let val = $("#hex_textarea").val().trim();
        if (val === "") {
            appendToOutput("报文不能为空", 1)
        } else {
            $.ajax({
                url: "/immotors/parse",
                method: "post",
                data: val,
                success: function (res) {
                    if (res.succeed) {
                        editor.set(JSON.parse(res.data))
                        appendToOutput("解析成功", 2)
                    } else {
                        appendToOutput(res.msg, 2)
                    }
                }
            })
            appendToOutput("发送http解析请求成功", 1)
        }
    }

    let outputCount = 0
    const maxOutputCount = 20

    function clearOutput() {
        $("#output").val("")
        outputCount = 0
    }

    function appendToOutput(msg, type) {
        let output = $("#output");
        if (outputCount >= maxOutputCount) {
            output.val("")
            outputCount = 0;
        }
        outputCount++
        let val = output.val();
        let date = new Date();
        let pre = getNowDateStr(date)
        if (type === 1) {
            pre += "(client)"
        } else {
            pre += "(server)"
        }
        const curMsg = pre + "\n" + msg + "\n"
        if (val === "") {
            output.val(curMsg)
        } else {
            output.val(curMsg + "\n" + val)
        }
    }


    function getNowDateStr(date) {
        const fullYear = date.getFullYear();
        const month = date.getMonth() + 1;
        let monthStr
        if (month < 10) {
            monthStr = "0" + month
        } else {
            monthStr = month
        }

        const day = date.getDate();
        let dayStr
        if (day < 10) {
            dayStr = "0" + day
        } else {
            dayStr = day
        }

        const hour = date.getHours();
        let hourStr
        if (hour < 10) {
            hourStr = "0" + hour
        } else {
            hourStr = hour
        }

        const minute = date.getMinutes();
        let minuteStr
        if (minute < 10) {
            minuteStr = "0" + minute
        } else {
            minuteStr = minute
        }

        const second = date.getSeconds();
        let secondStr
        if (second < 10) {
            secondStr = "0" + second
        } else {
            secondStr = second
        }

        const ms = date.getMilliseconds();
        let msStr
        if (ms < 10) {
            msStr = "00" + ms;
        } else if (ms < 100) {
            msStr = "0" + ms;
        } else {
            msStr = ms;
        }
        return fullYear + "-" + monthStr + "-" + dayStr + " " + hourStr + ":" + minuteStr + ":" + secondStr + "." + msStr

    }
</script>
</html>